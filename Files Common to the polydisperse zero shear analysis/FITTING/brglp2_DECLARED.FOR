C****BRGLP2****BRGLP2****BRGLP2****BRGLP2****BRGLP2****
C...
C...	IDENTIFICATION:  ROUTINE BRGLP2
C...	        (BRAGG LOOP2)
C...
C...	THIS ROUTINE IS A DISPATCHER FOR THE LINE 
C...	FITTING. IT READS IN THE VALUES OF THE STARTING GUESS PARAMETERS PLUS THE FIXED PARAMETERS FOR THE VARIABLES
C...  
C...
C...	NOTES ON VARIABLES:
C...	   NARRAY(1) = # OF DATA POINTS
C...	   NARRAY(2) = # OF INDEPENDENT VARIABLES
C...	   NARRAY(3) = TOTAL # OF PARAMETERS (FIXED & VARIED)
C...	   NARRAY(4) = # OF PARAMETERS FIXED
C...	   NARRAY(5) = INTERMEDIATE PRINTOUT SPECIFICATION
C...	   NARRAY(6) = FINAL PRINTOUT SPECIFICATION
C...	   NARRAY(8) = # OF ITERATIONS
C******************************************************
	SUBROUTINE	BRGLP2(LUNI)
	IMPLICIT NONE
      INTEGER     MAXPAR,MAXERR,MAXDAT
      INTEGER     LUNF,LUNO,NARRAY(8),LUNI,LUNT
      INTEGER     I,JJ,IB,J
      PARAMETER	(MAXPAR=20)
	PARAMETER	(MAXERR=3)
	PARAMETER	(MAXDAT=2000)
	COMMON		/BLK1/B(20),P(20),N,M,K
	COMMON		/BRAGG2/NARRAY,IB    
	COMMON		/BRAGG3/START
	REAL*8	    START(MAXPAR)
	DIMENSION	IB(20)
	CHARACTER(25) LABEL(20)
      REAL*8      B,P
      INTEGER     N,M,K                       
	INTEGER 	ERRLBL,ERRCNT
	INTEGER 	ISTART,IFINSH   
	DATA		LUNF/4/
						!

	LUNO = NARRAY(7)
	LUNT = LUNO

400	WRITE(LUNT,90400)			! GET GUESS PARAMETERS
90400	FORMAT('ENTER GUESS PARAMETERS ')
	READ(LUNI,*,END=2000,ERR=400)(B(I),I=1,NARRAY(3))
						! RESET START
	IF (LUNI.EQ.3)WRITE(6,*)'PARAMETERS= ',	(B(I),I=1,NARRAY(3))
460	DO 470 I=1,NARRAY(3)
	START(I)=B(I)
470	CONTINUE
						!
490   WRITE(LUNT,90490)
90490 FORMAT(' ENTER FIXED PARAMETERS')

          DO 30 JJ=1,MAXPAR
	    IB(JJ)=0
   30     CONTINUE

	READ (LUNI,*)(IB(I),I=1,NARRAY(4))
	IF (LUNI.EQ.3)WRITE(6,*)'FIXED PARAMETERS= ',(IB(I),I=1,NARRAY(4))

	
5200	WRITE(LUNT,95200)		
95200	FORMAT(' # OF ITERATIONS')         

	READ(LUNI,*,ERR=400)NARRAY(8)
      NARRAY(5)=1                         ! THIS IS A LEGACY PARAMETER JUST FIXED TO 1 AND REALLY NOT USED
      NARRAY(6)=1                         ! THIS IS A LEGACY PARAMETER JUST FIXED TO 1 AND REALLY NOT USED

						! PRINT PARAMETERS
510	WRITE(LUNT,90510)
90510	FORMAT(///'        PARAMETERS')
						! PRINT PARAMETERS WITH LABELS
	DO 540 I=1,NARRAY(3)			! AND INDICATE THOSE TO BE HELD
	DO 520 J=1,NARRAY(4)			! FIXED.
	IF (IB(J)-I)520,525,520
520	CONTINUE
	GO TO 530
525	WRITE(LUNO,90525)I,B(I),LABEL(I)
90525	FORMAT(I5,5X,F15.5,2X,A25,' <- THIS PARAMETER TO BE HELD ',
	1      'FIXED')
	GO TO 540
530	WRITE(LUNO,90530)I,B(I),LABEL(I)
90530	FORMAT(I5,5X,F15.5,2X,A25)
540	CONTINUE	
						             
	RETURN
 2000 CONTINUE                           
	END
